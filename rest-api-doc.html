<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <rest-api-doc></rest-api-doc>

@group REST Elements
@element rest-api-doc
@demo demo/doc.html
@hero hero.svg
-->
<dom-module id="rest-api-doc">

  <template>
    <style>
      :host {
        position: relative;
        display: block;
        box-sizing: border-box;
        font-family: 'Roboto', sans-serif;
      }
      paper-button {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #F44336;
        color: #fff;
      }
    </style>
    <content></content>
  </template>
</dom-module>

<script>

  Polymer({

    is: 'rest-api-doc',

    hostAttributes: {
      hidden: true
    },

    properties: {

      /**
       * The `title` of the request
       */
      title: String,

      /**
       * The `url` to send the request to
       */
      url: String,

      /**
       * The HTTP `method` of the request, e.g. `GET`, `POST`, etc.
       */
      method: {
        type: String,
        value: 'GET'
      },

      /**
       * Values the HTTP `parameters` has to or optionally can contain
       * @type {Array<{key: string, type: string, optional: boolean, values: string}>}
       */
      params: Array,

      /**
       * Values the `headers` of the HTTP Request has to or optionally can contain
       * @type {Array<{key: string, type: string, optional: boolean, values: string}>}
       */
      headers: Array,

      /**
       * Values the `body` of the HTTP Request has to or optionally can contain
       * @type {Array<{key: string, type: string, optional: boolean, values: string}>}
       */
      body: Array,

      explanation: String,

      /**
       * The `response` of the HTTP Request after it has been performed
       */
      response: {
        type: String,
        readOnly: true
      }
    },

    ready: function () {
      this.set('params', []);
      this.set('headers', []);
      this.set('body', null);
      this.set('explanation', '');

      this._observer = Polymer.dom(this).observeNodes(function (info) {
        this._setRequestInfo();
      });
    },

    _setRequestInfo: function () {
      var params = this.queryAllEffectiveChildren('rest-api-param');
      var headers = this.queryAllEffectiveChildren('rest-api-header');
      var body = this.queryAllEffectiveChildren('rest-api-body');
      var kvBody = this.queryAllEffectiveChildren('rest-api-kv-body');
      var explanation = this.queryAllEffectiveChildren('rest-api-explanation');
      // Check for duplicate body declaration
      if (body.length > 0 && kvBody > 0) {
        console.warn('Only use either <rest-api-body> or <rest-api-kv-body>, ' +
            'but not both for one api. Now using: <rest-api-body>');
        this.set('body', body[0]);
      } else if (body.length > 0) {
        this.set('body', body[0]);
      } else if (kvBody.length > 0) {
        this.set('body', kvBody);
      } else {
        this.set('body', null);
      }

      this.set('params', params);
      this.set('headers', headers);
      if (explanation.length > 0)
        this.set('explanation', explanation[0].innerHTML);
    }
  });

</script>
